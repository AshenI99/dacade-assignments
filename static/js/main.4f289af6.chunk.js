(this["webpackJsonpnear-101-frontend"]=this["webpackJsonpnear-101-frontend"]||[]).push([[0],{131:function(e,t,c){"use strict";c.r(t);var n=c(3),s=c.n(n),a=c(62),i=c.n(a),r=(c(70),c(71),c(9)),l=c(20),o=c(19),d=c(21),j=c(22),b=c(8),h=Object({NODE_ENV:"production",PUBLIC_URL:"/dacade-assignments",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).CONTRACT_NAME||"my-first.diac.testnet";var u=function(e){switch(e){case"mainnet":return{networkId:"mainnet",nodeUrl:"https://rpc.mainnet.near.org",contractName:h,walletUrl:"https://wallet.near.org",helperUrl:"https://helper.mainnet.near.org",explorerUrl:"https://explorer.mainnet.near.org"};case"testnet":return{networkId:"testnet",nodeUrl:"https://rpc.testnet.near.org",contractName:h,walletUrl:"https://wallet.testnet.near.org",helperUrl:"https://helper.testnet.near.org",explorerUrl:"https://explorer.testnet.near.org"};default:throw Error("Unknown environment '".concat(e,"'."))}},m=c(27),O=u("testnet");function x(){return(x=Object(l.a)(Object(r.a)().mark((function e(){var t;return Object(r.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(m.connect)(Object.assign({deps:{keyStore:new m.keyStores.BrowserLocalStorageKeyStore}},O));case 2:t=e.sent,window.walletConnection=new m.WalletConnection(t),window.accountId=window.walletConnection.getAccountId(),window.contract=new m.Contract(window.walletConnection.account(),O.contractName,{viewMethods:["getStory","getMyStories","getStories"],changeMethods:["newStory","editStory","deleteStory"]});case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(){return v.apply(this,arguments)}function v(){return(v=Object(l.a)(Object(r.a)().mark((function e(){return Object(r.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",window.walletConnection.getAccountId());case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(){window.walletConnection.requestSignIn(O.contractName)}function w(){return N.apply(this,arguments)}function N(){return(N=Object(l.a)(Object(r.a)().mark((function e(){var t;return Object(r.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f();case 2:return t=e.sent,console.log(t),e.abrupt("return",window.contract.getMyStories({sender:t}));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){var t=e.length>13?e.slice(0,13):e,c=new Date(parseInt(t));return(c.toDateString()+", "+c.toLocaleTimeString()).toString()}var S=c(0);function y(e){var t=e.story;e.fetchStories;Object(n.useEffect)((function(){b.FormSelect.init(document.querySelector("#status-edit-".concat(t.id)))}),[t]);var c=Object(n.useState)({title:t.title,description:t.description,status:t.status}),s=Object(j.a)(c,2),a=s[0],i=s[1],r=function(e){i(Object(d.a)(Object(d.a)({},a),{},Object(o.a)({},e.target.name,e.target.value)))};return Object(S.jsxs)("div",{children:[Object(S.jsxs)("div",{className:"modal-content",children:[Object(S.jsx)("h4",{className:"center",children:"Edit Your Story"}),Object(S.jsx)("div",{className:"row",children:Object(S.jsxs)("form",{action:"/stories",method:"POST",className:"col s12",children:[Object(S.jsx)("div",{className:"row",children:Object(S.jsxs)("div",{className:"input-field",children:[Object(S.jsx)("input",{type:"text",name:"title",id:"title",value:a.title,onChange:r,maxLength:40}),Object(S.jsx)("label",{className:"active",htmlFor:"title",children:"Title"})]})}),Object(S.jsx)("div",{className:"row",children:Object(S.jsxs)("div",{className:"input-field",children:[Object(S.jsxs)("select",{value:a.status,onChange:r,name:"status",id:"status-edit-".concat(t.id),children:[Object(S.jsx)("option",{value:"1",children:"Public"}),Object(S.jsx)("option",{value:"2",children:"Private"})]}),Object(S.jsx)("label",{htmlFor:"status-edit-".concat(t.id),children:"Status"})]})}),Object(S.jsx)("div",{className:"row mt5",children:Object(S.jsxs)("div",{className:"input-field",children:[Object(S.jsx)("input",{value:a.description,onChange:r,type:"text",name:"description",id:"description"}),Object(S.jsx)("label",{className:"active",htmlFor:"description",children:"Description"})]})})]})})]}),Object(S.jsxs)("div",{className:"modal-footer",children:[Object(S.jsx)("button",{className:"btn",id:"newstories",onClick:function(){return function(e,t){return window.contract.editStory({id:e,story:t})}(t.id,a).then((function(e){window.location.reload()}))},children:"Save"}),Object(S.jsx)("a",{href:"#!",id:"closeEdit",className:"modal-close waves-effect waves-green btn-flat",children:"Cancel"})]})]})}function C(e){var t=e.stories,c=e.fetchStories;Object(n.useEffect)((function(){var e=document.querySelectorAll(".modal");b.Modal.init(e),b.FormSelect.init(document.querySelector("#status"))}),[t]);var s=function(e){(function(e){return window.contract.deleteStory({id:e})})(e).then((function(e){return window.location.reload()}))};return Object(S.jsxs)(S.Fragment,{children:[t&&t.length>0?Object(S.jsxs)("div",{className:"container",children:[Object(S.jsx)("h3",{children:"Welcome"}),Object(S.jsx)("p",{children:"Here are your stories"}),Object(S.jsxs)("table",{className:"striped",children:[Object(S.jsx)("thead",{children:Object(S.jsxs)("tr",{children:[Object(S.jsx)("th",{children:"Title"}),Object(S.jsx)("th",{children:"Date"}),Object(S.jsx)("th",{children:"Status"}),Object(S.jsx)("th",{})]})}),Object(S.jsx)("tbody",{id:"my-stories",children:t&&t.map((function(e,t){return Object(S.jsxs)("tr",{children:[Object(S.jsx)("td",{children:Object(S.jsx)("a",{href:"#viewModal-".concat(e.id,"-m"),className:"modal-trigger",children:e.title})}),Object(S.jsx)("td",{children:g(e.createdAt)}),Object(S.jsx)("td",{children:Object(S.jsx)("span",{className:"dash-status",children:"1"===e.status?"Public":"Private"})}),Object(S.jsxs)("td",{children:[Object(S.jsx)("button",{"data-target":"editModal-".concat(e.id),className:"btn btn-small edit modal-trigger",children:Object(S.jsx)("i",{className:"fas fa-edit"})}),Object(S.jsx)("button",{onClick:function(){return s(e.id)},className:"btn red btn-small",children:Object(S.jsx)("i",{className:"fas fa-trash"})})]})]},t)}))})]})]}):Object(S.jsx)("p",{children:"You haven't created any stories. Why not create one using the plus button at the bottom right"}),t&&t.map((function(e,t){return Object(S.jsxs)(S.Fragment,{children:[Object(S.jsxs)("div",{id:"viewModal-".concat(e.id,"-m"),className:"modal modal-fixed-footer",children:[Object(S.jsxs)("div",{className:"modal-content",id:"viewModalContent",children:[Object(S.jsxs)("div",{className:"row",children:[Object(S.jsx)("div",{className:"col s12 m8",children:Object(S.jsx)("h4",{children:e.title})}),Object(S.jsxs)("div",{className:"col s12 m4",children:[Object(S.jsx)("button",{"data-target":"editModal-".concat(e.id),onClick:function(){return document.getElementById("closeMy").click()},className:"btn btn-small edit modal-trigger",children:Object(S.jsx)("i",{className:"fas fa-edit"})}),Object(S.jsx)("button",{onClick:function(){return s(e.id)},className:"btn red btn-small",children:Object(S.jsx)("i",{className:"fas fa-trash"})})]})]}),Object(S.jsxs)("h6",{children:[1===e.status?"Public":"Private"," story by"," ",e.owner," on ",g(e.createdAt)]}),Object(S.jsx)("p",{children:e.description})]}),Object(S.jsx)("div",{className:"modal-footer",children:Object(S.jsx)("a",{href:"#!",id:"closeMy",className:"modal-close waves-effect waves-green btn-flat",children:"Close"})})]},t),Object(S.jsx)("div",{id:"editModal-".concat(e.id),className:"modal modal-fixed-footer",children:Object(S.jsx)(y,{story:e,fetchStories:c})},t)]})}))]})}function k(e){var t=e.story;return Object(n.useEffect)((function(){var e=document.querySelectorAll(".modal");b.Modal.init(e)}),[]),Object(S.jsx)(S.Fragment,{children:Object(S.jsxs)("div",{className:"col",children:[Object(S.jsxs)("div",{className:"card",children:[Object(S.jsxs)("div",{className:"card-content center-align",children:[Object(S.jsx)("h5",{children:t.title}),Object(S.jsx)("p",{children:t.description.length>30?t.description.slice(30):t.description}),Object(S.jsx)("br",{}),Object(S.jsx)("div",{className:"chip",children:Object(S.jsx)("a",{href:"#",children:t.owner})})]}),Object(S.jsx)("div",{className:"card-action center-align",children:Object(S.jsx)("button",{"data-target":"viewModal-".concat(t.id,"-a"),className:"btn btn-grey modal-trigger open-view",children:"Read More"})})]}),Object(S.jsxs)("div",{id:"viewModal-".concat(t.id,"-a"),className:"modal modal-fixed-footer",children:[Object(S.jsxs)("div",{className:"modal-content",id:"viewModalContent",children:[Object(S.jsx)("h4",{children:t.title}),Object(S.jsx)("h6",{children:g(t.createdAt)}),Object(S.jsx)("p",{children:t.description})]}),Object(S.jsx)("div",{className:"modal-footer",children:Object(S.jsx)("a",{href:"#!",className:"modal-close waves-effect waves-green btn-flat",children:"Close"})})]})]})})}function M(){return Object(S.jsx)("div",{className:"center load",children:Object(S.jsx)("div",{className:"preloader-wrapper small active",children:Object(S.jsxs)("div",{className:"spinner-layer spinner-green-only",children:[Object(S.jsx)("div",{className:"circle-clipper left",children:Object(S.jsx)("div",{className:"circle"})}),Object(S.jsx)("div",{className:"gap-patch",children:Object(S.jsx)("div",{className:"circle"})}),Object(S.jsx)("div",{className:"circle-clipper right",children:Object(S.jsx)("div",{className:"circle"})})]})})})}function E(){var e=Object(n.useState)([]),t=Object(j.a)(e,2),c=t[0],s=t[1],a=Object(n.useState)([]),i=Object(j.a)(a,2),h=i[0],u=i[1],m=window.walletConnection.account(),O=Object(n.useState)({title:"",description:"",status:"1"}),x=Object(j.a)(O,2),f=x[0],v=x[1],p=function(e){v(Object(d.a)(Object(d.a)({},f),{},Object(o.a)({},e.target.name,e.target.value)))},N=Object(n.useCallback)(Object(l.a)(Object(r.a)().mark((function e(){return Object(r.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!m.accountId){e.next=11;break}return e.t0=u,e.next=4,window.contract.getStories();case 4:return e.t1=e.sent,(0,e.t0)(e.t1),e.t2=s,e.next=9,w();case 9:e.t3=e.sent,(0,e.t2)(e.t3);case 11:case"end":return e.stop()}}),e)}))));return console.log(f),Object(n.useEffect)((function(){var e=document.querySelectorAll(".modal"),t=b.Modal.init(e);console.log(t),console.log("hmmmm"),b.FormSelect.init(document.querySelector("#status")),N()}),[]),Object(S.jsx)(S.Fragment,{children:h&&h.length>0?Object(S.jsxs)("div",{id:"main",children:[Object(S.jsx)("div",{className:"header",children:Object(S.jsx)("nav",{className:"grey darken-3",children:Object(S.jsxs)("div",{className:"nav-wrapper container",children:[Object(S.jsx)("a",{href:"/dashboard",className:"brand-logo center",children:"StoryBooks"}),Object(S.jsx)("ul",{className:"right",children:Object(S.jsx)("li",{children:Object(S.jsx)("button",{className:"waves-effect waves-light btn",id:"account",children:window.walletConnection.account().accountId})})})]})})}),Object(S.jsx)("div",{className:"add_btn",children:Object(S.jsx)("div",{className:"fixed-action-btn",children:Object(S.jsx)("button",{"data-target":"addModal",className:"btn-floating btn-large waves-effect btn modal-trigger waves-light red",children:Object(S.jsx)("i",{className:"fa fa-plus"})})})}),Object(S.jsx)("div",{className:"alert mt-2",children:Object(S.jsx)("span",{id:"notification",children:"\u231b Loading..."})}),Object(S.jsx)(C,{stories:c,fetchStories:N}),Object(S.jsxs)("div",{className:"container",children:[Object(S.jsx)("h1",{className:"center",children:"All Public Stories"}),Object(S.jsx)("div",{className:"row",children:h&&h.map((function(e,t){return Object(S.jsx)(k,{story:e},t)}))})]}),Object(S.jsxs)("div",{id:"addModal",className:"modal modal-fixed-footer",children:[Object(S.jsxs)("div",{className:"modal-content",children:[Object(S.jsx)("h4",{className:"center",children:"Create New Story"}),Object(S.jsx)("div",{className:"row",children:Object(S.jsxs)("form",{action:"/stories",method:"POST",className:"col s12",children:[Object(S.jsx)("div",{className:"row",children:Object(S.jsxs)("div",{className:"input-field",children:[Object(S.jsx)("input",{type:"text",name:"title",id:"title",placeholder:"40 characters max. Elaborate in description",value:f.title,onChange:p,maxLength:40}),Object(S.jsx)("label",{className:"active",htmlFor:"title",children:"Title"})]})}),Object(S.jsx)("div",{className:"row",children:Object(S.jsxs)("div",{className:"input-field",children:[Object(S.jsxs)("select",{value:f.status,onChange:p,name:"status",id:"status",children:[Object(S.jsx)("option",{value:"1",children:"Public"}),Object(S.jsx)("option",{value:"2",children:"Private"})]}),Object(S.jsx)("label",{htmlFor:"status",children:"Status"})]})}),Object(S.jsx)("div",{className:"row mt5",children:Object(S.jsxs)("div",{className:"input-field",children:[Object(S.jsx)("input",{value:f.description,onChange:p,type:"text",name:"description",id:"description"}),Object(S.jsx)("label",{htmlFor:"description",children:"Description"})]})})]})})]}),Object(S.jsxs)("div",{className:"modal-footer",children:[Object(S.jsx)("button",{className:"btn",onClick:function(){(function(e){return e.createdAt=Date.now().toString(),window.contract.newStory({story:e})})(f).then((function(e){N(),document.getElementById("closeAdd").click()}))},children:"Save"}),Object(S.jsx)("a",{href:"#!",id:"closeAdd",className:"modal-close waves-effect waves-green btn-flat",children:"Cancel"})]})]})]}):Object(S.jsx)(M,{})})}function F(e){e.toggle;return Object(S.jsx)("div",{className:"card",id:"login",children:Object(S.jsxs)("div",{className:"card-content",children:[Object(S.jsxs)("h3",{children:[Object(S.jsx)("i",{className:"fas fa-book-reader"}),"Storybooks"]}),Object(S.jsx)("div",{className:"section",children:Object(S.jsx)("p",{className:"lead",children:"Create public and private stories from your life and see other's public stories"})}),Object(S.jsx)("div",{className:"divider"}),Object(S.jsx)("div",{className:"section",children:Object(S.jsx)("button",{className:"btn red darken-1",onClick:p,children:"Connect Wallet to Continue"})})]})})}function P(){return window.walletConnection.account().accountId?Object(S.jsx)(E,{}):Object(S.jsx)(F,{})}var T=function(e){e&&e instanceof Function&&c.e(3).then(c.bind(null,132)).then((function(t){var c=t.getCLS,n=t.getFID,s=t.getFCP,a=t.getLCP,i=t.getTTFB;c(e),n(e),s(e),a(e),i(e)}))},A=i.a.createRoot(document.getElementById("root"));window.nearInitPromise=function(){return x.apply(this,arguments)}().then((function(){A.render(Object(S.jsx)(s.a.StrictMode,{children:Object(S.jsx)(P,{})}))})).catch(console.error),T()},71:function(e,t,c){},76:function(e,t){},86:function(e,t){}},[[131,1,2]]]);
//# sourceMappingURL=main.4f289af6.chunk.js.map